---
title: SRE简介
date: 2021-05-09 18:05:50
tags: ['SRE']
categories: SRE
---
# SRE简介
> 站点可靠性工程师（Site Reliability Engineering）

### 背景

#### 系统管理员模式

`系统管理员`负责将现成的软件部署于生产环境，对外提供某种业务服务。
其主要工作是应付系统中产生的各种需要**人工干预**的事件已经业务部门的变更需求。

系统管理员和研发工程师的日常工作相差甚远，通常属于两个部门：Dev和Ops

Dev/Ops分离的问题：  
1. 直接成本  
   系统管理员团队依靠人工处理系统事件和实施变更，团队大小和系统规模线性相关
2. 间接成本  
   研发团队和运维团队背景不同，技术和工具相差甚远，同时工作目标也不相同。细节上的分歧积累起来，最后演变目标已经方向上的分歧，形成内部沟通问题，甚至上升到部门间的信任和尊重层面。

研发部门和运维部门的主要分歧点在于软件新版本、新配置的变更的发布速度上。
研发部门希望发布速度越快越好‘随时随地发布新版本’，运维部门则希望避免发生故障‘系统在生产环境正常工作就不要再进行任何改动’

### Google的解决之道：SRE

雇佣工程师开发系统代替人工操作  
工程师主要有两类（或者说后一类为前一类的基础上有更多的知识背景）
   1. 标准工程师
   2. 其他技术能力（Unix系统或者网络知识背景） 

SRE团队成员有下面两个特点：
1. 排斥重复性、手工性的操作
2. 有足够的技术能力快速开发软件系统代替手工操作

工作：
1. 工单处理、手工操作
2. 持续的、工程化的解决第一类工作

Google为SRE团队所做的传统运维工作设立了一个50%的上限，随着第二类工作的推进，第一类的工作所占时间应该会逐步下降，目标是整个系统可以自主运行，可以自主修复问题（可以做到吗？）。

职责：
1. 可用性改进
2. 延迟优化
3. 性能优化
4. 效率优化
5. 变更管理
6. 监控
7. 紧急事务处理
8. 容量规划与关联

> DevOps核心思想是尽早将IT相关技术与产品设计和开发过程相结合，着重强调自动化。可以认为是GoogleSRE的普适版本，SRE是DevOps在Google的具体实践。

#### SRE方法论

1. 确保长期关注研发工作  
  Google将传统运维工作的时间限制在50%，SRE团队将剩余的时间花费在研发项目上。
2. 保障服务SLO前提下最大化迭代速度  
   SRE团队和研发团队的最主要矛盾是迭代创新的速度和产品的稳定程度。
   “错误预算”是指任何产品都不是也不应该做到100%可靠。可靠性多少不是一个技术问题，而是一个产品问题，取决于下面几个方面：
   - 基于用户习惯，服务可靠性到达多少用户才会满意
   - 服务的可靠性不够，用户是否还有其他选择
   - 服务可靠程度是否影响用户对这个服务的使用模式  
  
   产品或者商业部门必须确定一个合理的可靠性目标。一旦建立，错误预算 = 1 - 可靠性目标。错误预算就意味着研发部门和SRE部门可以在这个范围内将这个预算用于新功能上线和产品创新等其他任何事情
   
   常用策略有：灰度测试和AB测试等

3. 监控系统  
   监控系统是SRE团队监控服务质量和可用性的一个主要手段。监控系统的设计策略很重要，最普通和传统的报警策略是针对某个特定情况或者监控值，一旦出现情况或者超过阈值就触发报警。这个策略不是非常有效：一个需要人工阅读和分析警报来决定是否需要采取某些行动的系统从本质上来说是错误的。  

   监控系统不应该依赖人来分析警报信息，而是系统自动分析，仅当需要用户执行某种操作时，才需要通知。

   监考系统应该只有三类输出：
   - 紧急警报（alert）  
   意味着收到警报的用户需要立即执行某种操作，目标是解决某种已经发生的问题或者避免即将发生的问题
   - 工单（Ticket）  
   意味着收到工单的用户应该执行某种操作，但是并非立即执行。系统不能自动解决目前的情况，但是一个用户几天内执行这项操作，系统不会收到任何影响
   - 日志（Logging） 
   平时没有人关注日志信息，但是日志信息收集起来以备调试和事后分析时使用

4. 紧急事件处理  
   可靠性是MTTF(平均失败时间)和MTTR(平均恢复时间)的函数。评价一个团队将系统恢复到正常情况的最有效指标就是MTTR.

   任何需要人工操作的事情都只会延长恢复时间。可以自动恢复的系统即使有更多故障发生，也比事事需要人工干预的系统可用性更高。

5. 变更管理  
   大约70%的生产事故由某种部署变更而触发。变更管理最近实践是使用自动化完成以下几个项目：
   - 采用渐进式发布机制
   - 迅速准确地检测到问题的发生
   - 出现问题时，安全迅速地回退改动

6. 容量规划  
   业务容量规划包含自然增长（用户使用量上升，资源也上升），非自然增长（新功能发布以及其他商业因素）
   步骤：
   - 准确的自然增长需求预测模型
   - 规划中必须有准确的非自然增长的需求来源的统计
   - 必须有周期性压力测试，以便将系统原始资源信息和业务容量对应起来

7. 资源部署  
   是变更管理和容量规划结合的产物。资源的部署和配置必须非常迅速的完成，仅仅在必要时才执行。

8. 效率与性能  
   资源使用情况由用户需求（流量）、可用容量和软件的资源使用效率所驱动的。
   SRE目标是根据一个预设的延迟目标部署和维护足够的容量。SRE和研发团队应该共同监控和优化整个系统的性能，相当于给服务增加容量和提示效率。

### 总结

GoogleSRE代表了行业现存管理大型复杂服务的最佳实践，由简单的想法“如何应付重复劳动的办法”而生，发展成具有指导思想、方法论、激励方法和广阔发展空间的独立职业。